<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.webapp.dao.VolProgramDao">
	<!-- volunteer_program - result map 정의 -->
	<resultMap id="VolProgramResultMap"
		type="com.mycompany.webapp.dto.VolProgramDto">
		<id property="programNo" column="program_no" />
		<result property="programTitle" column="program_title" />
		<result property="recruitStts" column="recruit_stts" />
		<result property="actBgnDate" column="act_bgn_date" />
		<result property="actEndDate" column="act_end_date" />
		<result property="actBgnTime" column="act_bgn_time" />
		<result property="actEndTime" column="act_end_time" />
		<result property="recruitBgnDate" column="recruit_bgn_date" />
		<result property="recruitEndDate" column="recruit_end_date" />
		<result property="recruitCnt" column="recruit_cnt" />
		<result property="applyCnt" column="apply_cnt" />
		<result property="programCtg" column="program_ctg" />
		<result property="adultPosbl" column="adult_posbl" />
		<result property="teenPosbl" column="teen_posbl" />
		<result property="recruitName" column="recruit_name" />
		<result property="actPlace" column="act_place" />
		<result property="mngName" column="mng_name" />
		<result property="mngTel" column="mng_tel" />
		<result property="regionNo" column="region_no" />
		<result property="battachOname" column="battach_oname" />
		<result property="battachData" column="battach_data" />
		<result property="battachType" column="battach_type" />
		<result property="imgOname" column="img_oname" />
		<result property="imgData" column="img_data" />
		<result property="imgType" column="img_type" />
		<result property="location" column="location" />
		<result property="enabled" column="enabled" />
		<result property="content" column="content" />
	</resultMap>
	<!-- ㅇ============================================================================================ㅇ -->
	<!-- ㅇ============================================================================================ㅇ -->
	<insert id="insertVolProgram" parameterType="volProgram">
		<selectKey keyProperty="programNo" resultType="int"
			order="BEFORE">
			select vol_program_no.nextval from dual
		</selectKey>
		insert into volunteer_program (
		program_no, program_title,
		recruit_stts, act_bgn_date, act_end_date,
		act_bgn_time, act_end_time,
		recruit_bgn_date, recruit_end_date,
		recruit_cnt,
		apply_cnt, program_ctg,
		adult_posbl, teen_posbl, recruit_name, act_place,
		mng_name, mng_tel,
		region_no, battach_oname, battach_data,
		battach_type, img_oname,
		img_data, img_type, location, enabled, content)
		values (
		#{programNo},
		#{programTitle}, #{recruitStts}, #{actBgnDate}, #{actEndDate},
		#{actBgnTime},#{actEndTime}, #{recruitBgnDate}, #{recruitEndDate},
		#{recruitCnt},
		0, #{programCtg}, #{adultPosbl}, #{teenPosbl},
		#{recruitName},
		#{actPlace},
		#{mngName}, #{mngTel}, #{regionNo},
		#{battachOname}, #{battachData},
		#{battachType}, #{imgOname},
		#{imgData}, #{imgType}, #{location}, 1, #{content})
	</insert>
	<!-- ㅇ============================================================================================ㅇ -->
	<!-- ㅇ============================================================================================ㅇ -->
	<select id="selectVolCount" resultType="int">
		select count(*) from
		volunteer_program
		where enabled = 1
		<if test="startDate != null">
			and (act_bgn_date <![CDATA[<=]]> #{endDate})
			and (act_end_date) <![CDATA[>=]]> #{startDate})
		</if>
		<if test="regionNo != 0">
			and region_no = #{regionNo}
		</if>
		<if test="ctgNo != null and ctgNo != ''">
			and program_ctg = #{ctgNo}
		</if>
		<if test="adultPosbl == 1">
			and adult_posbl = 1
		</if>
		<if test="teenPosbl == 1">
			and teen_posbl = 1
		</if>
		<if test="keyword != null and keyword != ''">
			and program_title like '%' || #{keyword} || '%'
		</if>
		<if test="recruitStts == 1">
			and recruit_stts = 1
		</if>
		<if test="recruitStts == 2">
			and recruit_stts = 2
		</if>
	</select>
	<!-- ㅇ============================================================================================ㅇ -->
	<!-- ㅇ============================================================================================ㅇ -->
	<select id="selectVolList" resultType="volProgram">
		select rnum, program_no, program_title, act_bgn_date, act_end_date, recruit_stts,
		act_bgn_time, act_end_time, recruit_bgn_date, recruit_end_date,
		program_ctg, recruit_name, act_place, region_no
		from (
		select rownum as
		rnum, program_no, program_title, act_bgn_date,
		act_end_date, recruit_stts,
		act_bgn_time, act_end_time, recruit_bgn_date,
		recruit_end_date,
		program_ctg, recruit_name, act_place, region_no
		from (
		select
		program_no, program_title, act_bgn_date, act_end_date, act_bgn_time, 
		act_end_time, recruit_stts, recruit_bgn_date, recruit_end_date,
		program_ctg,
		recruit_name, act_place, region_no
		from volunteer_program
		where enabled
		= 1
		<if test="searchIndex.startDate != null">
			and (act_bgn_date <![CDATA[<=]]> #{searchIndex.endDate})
			and (act_end_date) <![CDATA[>=]]> #{searchIndex.startDate})
		</if>
		<if test="searchIndex.regionNo != null and searchIndex.regionNo != ''">
			and region_no = #{searchIndex.regionNo}
		</if>
		<if test="searchIndex.ctgNo != null and searchIndex.ctgNo != ''">
			and program_ctg = #{searchIndex.ctgNo}
		</if>
		<if test="searchIndex.adultPosbl == 1">
			and adult_posbl = 1
		</if>
		<if test="searchIndex.teenPosbl == 1">
			and teen_posbl = 1
		</if>
		<if test="searchIndex.keyword != null and searchIndex.keyword != ''">
			and program_title like '%' || #{searchIndex.keyword} || '%'
		</if>
		<if test="searchIndex.recruitStts == 1">
			and recruit_stts = 1
		</if>
		<if test="searchIndex.recruitStts == 2">
			and recruit_stts = 2
		</if>
		order by program_no desc
		)
		where rownum <![CDATA[<=]]>
		#{pager.endRowNo}
		)
		where rnum <![CDATA[>=]]>
		#{pager.startRowNo}

	</select>
	<!-- ㅇ============================================================================================ㅇ -->
	<!-- ㅇ============================================================================================ㅇ -->
	<select id="selectVolProgramByNo" parameterType="int"
		resultMap="VolProgramResultMap">
		select *
		from volunteer_program
		where program_no =
		#{programNo}
	</select>
	<!-- ㅇ============================================================================================ㅇ -->
	<!-- ㅇ============================================================================================ㅇ -->
    <update id="updateVolProgram" parameterType="volProgram">
		update volunteer_program set program_title = #{programTitle},
		 recruit_stts = #{recruitStts}, act_bgn_date = #{actBgnDate},
		 act_end_date = #{actEndDate}, act_bgn_time = #{actBgnTime},
		 act_end_time = #{actEndTime}, recruit_bgn_date = #{recruitBgnDate},
		 recruit_end_date = #{recruitEndDate}, recruit_cnt = #{recruitCnt},
		 apply_cnt = #{applyCnt}, program_ctg = #{programCtg}, adult_posbl = #{adultPosbl},
		 teen_posbl = #{teenPosbl}, recruit_name = #{recruitName}, act_place = #{actPlace},
		 mng_name = #{mngName}, mng_tel = #{mngTel}, region_no = #{regionNo}, location = #{location},
		 content = #{content}
		<if test="battachOname != null">
			, battach_oname=#{battachOname}
			,
			battach_type=#{battachType}
			, battach_data=#{battachData}
		</if>
		<if test="imgOname != null">
			, img_oname=#{imgOname}
			, img_type=#{imgType}
			,
			img_data=#{imgData}
		</if>
		where program_no = #{programNo}
	</update>

	<update id="updateVolProgramEnabled">
		update volunteer_program set enabled = 0 where program_no = #{programNo}
	</update>
	
	<update id="updateVolProgramApplCnt">
		update volunteer_program
		set
		<if test="isFull">
			recruit_stts = 2, apply_cnt = apply_cnt + 1
		</if>
		<if test="!isFull">
			apply_cnt = apply_cnt + 1
		</if>
		where program_no = #{programNo}
	</update>

</mapper>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             